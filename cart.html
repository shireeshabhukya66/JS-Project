<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Shopping Cart</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <!-- HEADER -->
    <header class="header">
        <img src="images/pastery.png">
        <span id="ocs">
            <h1>SHOW ADD TO CART CAKES</h1>
        </span>
    </header>
    <div id="cartContainer"></div>

    <div id="cartSummary" class="d-none">
        <h3>Total Price: ₹<span id="totalPrice">0</span></h3>
        <button id="clearCartBtn">Clear Cart</button>
    </div>

    <div id="placeOrder">
        <button id="placeOrderBtn">Place Order</button>
    </div>


    <form action="placeOrder" style="display: none;" id="orderform">
        <label>H.No:</label>
        <input type="number" placeholder="Enter your H.No"><br>
    
        <label>Street :</label>
        <input type="text" placeholder="Enter your Street"><br>
    
        <label>Area :</label>
        <input type="text" placeholder="Enter your Area"><br>
    
        <label>State :</label>
        <input type="text" placeholder="Enter State"><br>
    
        <label>Pincode :</label>
        <input type="number" placeholder="Enter Pincode"><br>
    
        <button class="btn btn-primary">Submit</button>
    </form>

    <script>
        function loadCart() {
            let cart = JSON.parse(localStorage.getItem("cart")) || [];

            const cartContainer = document.getElementById("cartContainer");
            const cartSummary = document.getElementById("cartSummary");
            const totalPriceEl = document.getElementById("totalPrice");
            const placeOrderSection = document.getElementById("placeOrder");

            if (cart.length === 0) {
                cartContainer.innerHTML = "<h2>No items in cart</h2>";

                // Hide everything else
                cartSummary.classList.add("d-none"); //adds css class d-none 
                placeOrderSection.style.display = "none";
                orderForm.style.display = "none";
                return;  // stop function
            }

            //If cart has items
            placeOrderSection.style.display = "block"; 
            cartSummary.classList.remove("d-none");   


            cartContainer.innerHTML = "";
            let totalPrice = 0; 

            cart.forEach((item, index) => {        //index helps identify item to update or remove
                let qty = item.quantity || 1;      // If quantity is not set, use default 1
                totalPrice += Number(item.price) * qty;

                cartContainer.innerHTML += `
                <div class="cartCard">
                    <img src="${item.image}" width="120">
                    <div id="cartContent">
                    <h3>${item.title}</h3>
                    <p>Price: ₹${item.price}</p>

                     <!-- Quantity Control -->
                <div class="qtyBox">
                    <button class="decreaseBtn" data-index="${index}">−</button>
                    <span class="qty">${qty}</span>
                    <button class="increaseBtn" data-index="${index}">+</button>
                </div>

                    <button class="removeBtn" data-index="${index}">
                        Remove
                    </button>
                </div>
                </div>
                <hr>
            `;
            });

            totalPriceEl.textContent = totalPrice.toFixed(2);
            cartSummary.classList.remove("d-none");   //show cartSummary
            addRemoveEvent();
            addQuantityEvents();                     //turns on remove and quantity buttons
        }


        function addQuantityEvents() {
            const increaseBtns = document.querySelectorAll(".increaseBtn");
            const decreaseBtns = document.querySelectorAll(".decreaseBtn");

            increaseBtns.forEach(btn => {
                btn.addEventListener("click", () => {
                    let index = btn.dataset.index;    // If user clicks + on item 2 → index = 2
                                                      //  Helps identify which cart item to update.
                    let cart = JSON.parse(localStorage.getItem("cart")) || [];
                    cart[index].quantity = (cart[index].quantity || 1) + 1;
                    localStorage.setItem("cart", JSON.stringify(cart));
                    loadCart();
                });
            });

            decreaseBtns.forEach(btn => {
                btn.addEventListener("click", () => {
                    let index = btn.dataset.index;
                    let cart = JSON.parse(localStorage.getItem("cart")) || [];
                    if ((cart[index].quantity || 1) > 1) {
                        cart[index].quantity -= 1;
                        localStorage.setItem("cart", JSON.stringify(cart));
                        loadCart();   //Reloads the cart display in the browser.
                    }
                });
            });
        }


        function addRemoveEvent() {
            const removeBtns = document.querySelectorAll(".removeBtn");

            removeBtns.forEach(btn => {
                btn.addEventListener("click", () => {
                    let index = btn.dataset.index;
                    let cart = JSON.parse(localStorage.getItem("cart")) || [];

                    cart.splice(index, 1);
                    localStorage.setItem("cart", JSON.stringify(cart));

                    loadCart();   //reloads the cart display in the browser
                });
            });
        }

        document.getElementById("clearCartBtn").addEventListener("click", () => {
            localStorage.removeItem("cart");
            loadCart();
        });

        loadCart();  //refresh the UI




        const orderForm = document.getElementById("orderform");
        
        // Place Order Button -- display form
        document.getElementById("placeOrderBtn").addEventListener("click", function () {
            document.querySelector("form").style.display = "block";
            });

   
        // Local Storage Place Order
        orderForm.addEventListener("submit", function (e) {
            e.preventDefault();

            // Get cart items
            const cart = JSON.parse(localStorage.getItem("cart")) || [];
            if (cart.length === 0) {
                alert("Your cart is empty!");
                return;
            }

            //This line calculates the total cost of all items in the cart including their quantities
            let totalPrice = cart.reduce((sum, item) => sum + Number(item.price) * (item.quantity || 1), 0);

            // Get user address from form
            const address = {
                hNo: orderForm.querySelector('input[placeholder="Enter your H.No"]').value,
                street: orderForm.querySelector('input[placeholder="Enter your Street"]').value,
                area: orderForm.querySelector('input[placeholder="Enter your Area"]').value,
                state: orderForm.querySelector('input[placeholder="Enter State"]').value,
                pincode: orderForm.querySelector('input[placeholder="Enter Pincode"]').value
            };

            // Create full order object
            const fullOrder = {
                items: cart,
                total: totalPrice.toFixed(2),
                address: address,
                date: new Date().toLocaleString()
            };

            const orders = JSON.parse(localStorage.getItem("orders")) || [];
            
            // Add new order
            orders.push(fullOrder);

            // Save back to localStorage
            localStorage.setItem("orders", JSON.stringify(orders));

            loadCart();   //refresh the UI
            orderForm.reset();  //Clears all input fields in the form

            orderForm.style.display = "none";
            alert("Order placed successfully!");
        });

    </script>
</body>
</html>